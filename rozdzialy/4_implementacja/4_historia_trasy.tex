\section{Historia przegl¹dania oraz zaprogramowane trasy}
Specyfika dzia³ania aplikacji, zwi¹zana z wykonywaniem przez u¿ytkownika akcji nawigacyjnych, oraz œrodowisko dzia³ania sk³oni³y do zaimplementowania funkcjonalnoœci zwi¹zanych z histori¹. Znacz¹co u³atwi¹ i przyspiesz¹ one poruszanie siê po wêz³ach grafu. Bez mo¿liwoœci skorzystania z historii u¿ytkownik by³by zmuszony do ka¿dorazowego szukania poprzedniego wêz³a  w grafie b¹dŸ w odpowiednim widoku wybranego wêz³a. Co wiêcej, aby zapewniæ powtarzalnoœæ podczas prezentacji, a tak¿e, aby wyeksponowaæ ciekawe przypadki po³¹czeñ pomiêdzy wêz³ami, bêdzie mo¿liwe zapisanie tras przegl¹dania. Odtwarzanie tras umo¿liwia dok³adne planowanie prezentacji i eliminuje problemy wynikaj¹ce z losowoœci wyœwietlania wêz³ów. 

Do historii zapisywane s¹ tylko akcje kluczowe dla nawigacji - zmiana widoku wyœwietlania oraz wybieranie wêz³ów. Inne dzia³ania u¿ytkownika nie powoduj¹ znacz¹cych zmian w nawigacji po grafie i ich przechowywanie jest bezcelowe. Po naciœniêciu Przycisku 2 na kontrolerze wywo³ywana jest poprzednia akcja wykonana przez u¿ytkownika. Odpowiednio, aby ponowiæ cofniêt¹ akcjê, nale¿y nacisn¹æ Przycisk 3. W przypadku braku akcji do ponowienia lub cofniêcia nie jest podejmowane ¿adne dzia³anie. Wywo³ywanie i zapisywanie tras dostêpne jest z poziomu konsoli operatora opisanej w nastêpnym punkcie.


Akcje u¿ytkownika s¹ przechowywane jako odpowiednie klasy dziedzicz¹ce po klasie UserAction. Posiada ona wirtualne funkcje Execute() oraz UnExecute() s³u¿¹ce odpowiednio ponawianiu i cofaniu akcji. Ka¿da akcja posiada tak¿e swojego w³asnego delegata, zale¿nego od typu akcji. 

Bezpoœrednie operacje na historii wykonywane s¹ przez HistoryService. Przechowuje on akcje u¿ytkownika we dwu stosach: pierwszy s³u¿y zapisywaniu akcji do cofniêcia, drugi akcji do ponowienia. W momencie wciœniêcia przycisku 2 wyzwalane jest zdarzenie wywo³uj¹ce funkcjê UndoAction(), która poza wykonaniem kolejnego zdarzenia wywo³uj¹cego funkcjê akcji odpowiedzialnej za cofanie, zdejmuje tê akcjê ze stosu akcji do cofania i wk³ada na stos akcji do ponawiania.

Wszystkie delegowane funkcje s³u¿¹ce historii oraz trasom s¹ przypisywane w kontrolerze HistoryController. Warunkiem jest, aby aplikacja by³a serwerem.

Zaznaczanie wêz³ów z historii oraz zmiana widoku odbywa siê w identyczny sposób, jak zwyk³e wywo³ywanie tych akcji przy u¿yciu kontrolera, jednak nie s¹ one ponowne zapisywane do historii, jak przy zwyk³ym wywo³aniu.

Analogicznie do modu³u historii zaprojektowane zosta³o odtwarzanie tras. Pliki zawieraj¹ce trasy posiadaj¹ rozszerzenie .wgroute. Struktura pliku jest stosunkowo prosta - pierwsza cyfra s³u¿y rozró¿nieniu akcji u¿ytkownika: 0 oznacza zmianê widoku, a 1 wybranie wêz³a. W przypadku zmiany widoku po œredniku mo¿na znaleŸæ cyfrê 0 lub 1. 0 odpowiada zmianie widoku na na widok dzieci, a 1 zmianie widoku na widok rodziców. Jeœli akcj¹ by³o wybranie wêz³a, po œredniku znajduje siê ID artyku³u do wybrania. 

Po wybraniu trasy rozpoczyna siê proces jej wczytywania. S¹ za to odpowiedzialne dwie klasy: RoutesReader oraz RoutesLoader. Pierwsza ma za zadanie pobraæ dostêpne trasy, ich nazwy i d³ugoœæ oraz wczytywaæ kolejne linijki plików. Druga przekszta³ca wczytane dane linijka po linijce na odpowiednie akcje i dopisuje do stosu.

W momencie w³¹czenia trasy inicjowane jest wczytanie trasy z plików, a po tej operacji tworzony jest wspó³program(ang. coroutine), która ma za zadanie wykonywanie kolejnych akcji trasy co dan¹ liczbê sekund. Odtwarzanie trasy sygnalizowane jest przez ikonê AUTO w nag³ówku. W ka¿dym momencie mo¿liwe jest wy³¹czenie odtwarzania trasy za pomoc¹ Przycisku 4, powoduj¹cego zatrzymanie wspó³programu. W przypadku w³¹czenia innej trasy w trakcie odtwarzania, wspó³program poprzedniej trasy jest tak¿e wy³¹czany, a nastêpnie wczytywana i inicjalizowana jest nowa trasa. 

